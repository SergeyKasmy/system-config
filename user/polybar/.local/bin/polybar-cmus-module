#!/bin/sh

grep_field() {
	echo "$1" | grep " ${2} " | cut -d' ' -f3-
}


if info=$(cmus-remote -Q 2>/dev/null); then
	status=$(echo "$info" | grep "status " | cut -d' ' -f2)
	if [ "$status" = "playing" ] || [ "$status" = "paused" ] || [ "$status" = "stopped" ]; then

		if [ "$status" = "playing" ]; then
			icon='契 '
		elif [ "$status" = "paused" ]; then
			icon=' '
		elif [ "$status" = "stopped" ]; then
			icon='栗'
		fi

		artist=$(grep_field "$info" "artist")
		title=$(grep_field "$info" "title")
		
		vol_left=$(grep_field "$info" "vol_left")
		vol_right=$(grep_field "$info" "vol_right")

		if (( vol_left == vol_right )); then
			vol="$vol_left"
		else
			vol="${vol_left}/${vol_right}"
		fi

		echo "${icon}${artist} - ${title} [vol: ${vol}]" > /tmp/polybar/cmus
		polybar-msg hook cmus 1
	fi
else
	polybar-msg hook cmus 2
fi
